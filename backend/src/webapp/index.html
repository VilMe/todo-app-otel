<!DOCTYPE html>
<html>
<head>
    <title>To-Do List</title>
</head>
<body>
    <h1>To-Do List</h1>
    <ul id="list"></ul>
    <input type="text" id="desc" placeholder="New task...">
    <button onclick="addTodo()">Add</button>
    <script>
        function loadTodos() {
            fetch('/todoapp/todos')
                .then(res => res.json())
                .then(data => {
                    const list = document.getElementById('list');
                    list.innerHTML = '';
                    data.forEach(todo => {
                        const li = document.createElement('li');
                        li.innerHTML = `<span ${todo.completed ? "style='text-decoration:line-through'" : ""}>${todo.description}</span>
                          <button onclick="editTodo(${todo.id}, '${todo.description.replace(/'/g, "\\'")}', ${todo.completed})">Edit</button>
                          <button onclick="deleteTodo(${todo.id})">Delete</button>
                          <button onclick="markDone(${todo.id}, ${!todo.completed})">${todo.completed ? "Undo" : "Done"}</button>`;
                        list.appendChild(li);
                    });
                });
        }
        function addTodo() {
            const desc = document.getElementById('desc').value;
            fetch('/todoapp/todos', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ description: desc })
            }).then(() => {
                loadTodos();
                document.getElementById('desc').value = '';
            });
        }
        function editTodo(id, currentDesc, completed) {
            const newDesc = prompt("Edit description:", currentDesc);
            if (newDesc !== null) {
                fetch(`/todoapp/todos/${id}`, {
                    method: 'PUT',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({description: newDesc, completed: completed})
                }).then(loadTodos);
            }
        }
        function deleteTodo(id) {
            fetch(`/todoapp/todos/${id}`, { method: 'DELETE' }).then(loadTodos);
        }
        function markDone(id, newStatus) {
            fetch(`/todoapp/todos/${id}`, {
                method: 'PUT',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({completed: newStatus})
            }).then(loadTodos);
        }
        window.onload = loadTodos;
    </script>
</body>
</html>